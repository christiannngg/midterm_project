import hashlib
import os

def load_malicious_hashes(hash_file="malware_hashes.txt"):
    try:
        with open(hash_file, 'r') as f:
            return set(line.strip() for line in f if line.strip())
    except FileNotFoundError:
        print(f"[!] Warning: {hash_file} not found!")

def calculate_hash(file_path):
    try:
        with open(file_path, 'rb') as file:
            hasher = hashlib.sha256()
            while chunk := file.read(8192):
                hasher.update(chunk)
            return hasher.hexdigest()
    except FileNotFoundError:
        print(f"[!] Error: File {file_path} not found.")
        return None
    except Exception as e:
        print(f"[!] Error scanning {file_path}: {e}")
        return None

def scan_file(file_path, malicious_signatures):
    file_hash = calculate_hash(file_path)
    if file_hash:
        print(f"[*] Scanning: {file_path}")
        print(f"    Hash: {file_hash}")
        if file_hash in malicious_signatures:
            print(f"[!] WARNING: {file_path} is flagged as MALICIOUS!")
        else:
            print(f"[+] {file_path} is clean.")
    print("-" * 50)

def scan_directory(directory, malicious_signatures):
    print(f"[*] Scanning directory: {directory}\n")
    for root, _, files in os.walk(directory):
        for file in files:
            file_path = os.path.join(root, file)
            scan_file(file_path, malicious_signatures)

def main():
    malicious_signatures = load_malicious_hashes()

    # use clean/malware .txt files to scan
    target = input("Enter file or directory to scan: ").strip()
    if os.path.isdir(target):
        scan_directory(target, malicious_signatures)
    elif os.path.isfile(target):
        scan_file(target, malicious_signatures)
    else:
        print("[!] Invalid path. Please enter a valid file or directory.")


if __name__ == "__main__":
    main()
